<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Avatar de Gato con Minijuego</title>
<style>
  body { font-family: Arial; text-align: center; background: #f4f4f4; margin:0; padding:0; }
  h2 { margin:15px 0; }

  .grid { 
    display: grid; 
    grid-template-columns: repeat(3,100px); 
    grid-template-rows: repeat(3,100px); 
    gap:5px; 
    justify-content:center; 
    margin:20px auto; 
    transition: all 0.3s ease;
  }
  .cell { 
    background:#ddd; 
    display:flex; 
    align-items:center; 
    justify-content:center; 
    font-size:40px; 
    transition: background 0.3s ease;
  }
  .avatar { font-size:48px; }
  .controls { margin:10px auto; display:flex; flex-wrap:wrap; justify-content:center; max-width:400px; }
  .btn { flex:1 1 auto; padding:10px 15px; margin:5px; font-size:16px; cursor:pointer; border:none; border-radius:6px; color:#fff; min-width:80px; }
  #status { margin-top:10px; font-weight:bold; padding:0 10px; }
  #last { margin-top:5px; font-style:italic; color:#555; }

  /* Colores por modo */
  .mode-voice .cell { background:#cce5ff; }
  .mode-motion .cell { background:#d4edda; }
  .mode-game .cell { background:#fff3cd; }
  .mode-normal .cell { background:#ddd; }

  /* Colores botones */
  .btn-normal { background:#6c757d; }
  .btn-voice { background:#007bff; }
  .btn-motion { background:#28a745; }
  .btn-game { background:#ffc107; color:#000; }
  .btn-exit { background:#dc3545; display:none; }

  /* --- Responsive smartphone --- */
  @media (max-width:600px){
    .grid { grid-template-columns: repeat(3,80px); grid-template-rows: repeat(3,80px); gap:4px; }
    .cell { font-size:30px; }
    .avatar { font-size:40px; }
    .controls { max-width:100%; padding:0 10px; }
    .btn { font-size:18px; padding:12px; min-width:100px; flex: 1 1 45%; } 
    h2 { font-size:20px; }
  }

  @media (max-width:400px){
    .grid { grid-template-columns: repeat(3,70px); grid-template-rows: repeat(3,70px); }
    .btn { font-size:16px; min-width:90px; }
  }
</style>
</head>
<body>

<h2>Interacci√≥n Multimodal üê±</h2>
<div class="grid mode-normal" id="grid"></div>

<div class="controls">
  <!-- Controles normales -->
  <button class="btn btn-normal" onclick="move('left')">‚óÄ</button>
  <button class="btn btn-normal" onclick="move('up')">‚ñ≤</button>
  <button class="btn btn-normal" onclick="move('down')">‚ñº</button>
  <button class="btn btn-normal" onclick="move('right')">‚ñ∂</button>
  
  <!-- Controles por voz -->
  <button class="btn btn-voice" onclick="startVoice()">üé§ Voz</button>
  <button id="exitVoiceBtn" class="btn btn-exit" onclick="exitVoice()">‚úñ Cancelar Voz</button>
  
  <!-- Controles por movimiento -->
  <button class="btn btn-motion" onclick="startMotion()">üì± Movimiento</button>
  <button id="exitMotionBtn" class="btn btn-exit" onclick="exitMotion()">‚úñ Cancelar Movimiento</button>
  
  <!-- Modo juego -->
  <button class="btn btn-game" onclick="startGame()">üéÆ Jugar</button>
  <button id="exitGameBtn" class="btn btn-exit" onclick="exitGame()">‚úñ Cancelar Juego</button>
</div>

<div id="status">Usa botones, voz o inclina el tel√©fono.</div>
<div id="last">√öltimo puntaje: -</div>

<script>
const grid = document.getElementById("grid");
const size = 3;
let row = 1, col = 1;
const avatar = document.createElement("div");
avatar.className = "avatar";
avatar.textContent = "üê±";

for (let r=0; r<size; r++){
  for (let c=0; c<size; c++){
    const cell = document.createElement("div");
    cell.className="cell";
    cell.id=`cell-${r}-${c}`;
    grid.appendChild(cell);
  }
}
document.getElementById(`cell-${row}-${col}`).appendChild(avatar);

let gameMode = false;
let score = 0;
let timeLeft = 0;
let timerInterval = null;
let lastScore = null; 
let listening = false;
let recognition;
let motionActive = false;
let motionInterval = null;
let fishes = [];

const exitVoiceBtn = document.getElementById("exitVoiceBtn");
const exitMotionBtn = document.getElementById("exitMotionBtn");
const exitGameBtn = document.getElementById("exitGameBtn");

function setMode(mode){
  grid.className = `grid mode-${mode}`;
}

// --- funci√≥n mover ---
function move(dir){
  if(dir==="up") row = Math.max(0,row-1);
  if(dir==="down") row = Math.min(size-1,row+1);
  if(dir==="left") col = Math.max(0,col-1);
  if(dir==="right") col = Math.min(size-1,col+1);

  renderGrid();
  if(gameMode) checkCollision();
  document.getElementById("status").innerText = 
    gameMode ? `üêü Puntos: ${score} | ‚è± Tiempo: ${timeLeft}s` 
             : "Movimiento: " + dir;
}

function renderGrid(){
  document.querySelectorAll(".cell").forEach(c=>c.innerHTML="");
  document.getElementById(`cell-${row}-${col}`).appendChild(avatar);
  if(gameMode){
    fishes.forEach(f=>{
      const fishEl = document.createElement("div");
      fishEl.textContent = "üêü";
      document.getElementById(`cell-${f.r}-${f.c}`).appendChild(fishEl);
    });
  }
}

// --- VOZ ---
function startVoice(){
  if(!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)){
    alert("Este navegador no soporta reconocimiento de voz");
    return;
  }
  if(!recognition){
    const SR = window.SpeechRecognition||window.webkitSpeechRecognition;
    recognition = new SR();
    recognition.lang="es-MX";
    recognition.onresult = (e)=>{
      const txt = e.results[0][0].transcript.toLowerCase();
      if(txt.includes("arriba")) move("up");
      if(txt.includes("abajo")) move("down");
      if(txt.includes("izquierda")) move("left");
      if(txt.includes("derecha")) move("right");
    };
    recognition.onend = ()=>{ if(listening) recognition.start(); };
  }
  recognition.start();
  listening=true;
  document.getElementById("status").innerText="üé§ Voz activada";
  setMode("voice");
  exitVoiceBtn.style.display="inline-block";
}
function exitVoice(){
  if(recognition){ recognition.stop(); }
  listening=false;
  setMode("normal");
  document.getElementById("status").innerText="üé§ Voz desactivada";
  exitVoiceBtn.style.display="none";
}

// --- MOVIMIENTO ---
function startMotion(){
  if (typeof DeviceOrientationEvent !== "undefined" && 
      typeof DeviceOrientationEvent.requestPermission === "function") {
    DeviceOrientationEvent.requestPermission()
      .then(response => {
        if (response === "granted") {
          window.addEventListener("deviceorientation", handleOrientation);
          motionActive = true;
          document.getElementById("status").innerText="üì± Movimiento activado";
          setMode("motion");
          exitMotionBtn.style.display="inline-block";
        }
      })
      .catch(console.error);
  } else {
    window.addEventListener("deviceorientation", handleOrientation);
    motionActive = true;
    document.getElementById("status").innerText="üì± Movimiento activado";
    setMode("motion");
    exitMotionBtn.style.display="inline-block";
  }
}
function exitMotion(){
  window.removeEventListener("deviceorientation", handleOrientation);
  clearInterval(motionInterval);
  motionActive = false;
  motionInterval = null;
  setMode("normal");
  document.getElementById("status").innerText="üì± Movimiento desactivado";
  exitMotionBtn.style.display="none";
}
function handleOrientation(event){
  if(!motionActive) return;
  let tiltX = event.gamma; 
  let tiltY = event.beta;  
  let dir = null;

  if(tiltY < 5) dir = "up";
  else if(tiltY > 75) dir = "down";
  else if(tiltX < -30) dir = "left";
  else if(tiltX > 30) dir = "right";

  if(dir){
    if(!motionInterval){
      move(dir);
      motionInterval = setInterval(()=>move(dir), 700); 
    }
  } else {
    clearInterval(motionInterval);
    motionInterval = null;
  }
}

// --- JUEGO con verificaci√≥n de modo activo ---
function startGame(){
  if(listening || motionActive){
    const activeModes = [];
    if(listening) activeModes.push("Voz");
    if(motionActive) activeModes.push("Movimiento");

    const confirmStart = confirm(
      `Actualmente tienes activado el modo: ${activeModes.join(", ")}.\n` +
      "Se desactivar√°n al empezar el juego. ¬øDeseas continuar?"
    );
    if(!confirmStart) return;

    // Desactivar modos activos
    if(listening) exitVoice();
    if(motionActive) exitMotion();
  }

  // L√≥gica normal de iniciar el juego
  gameMode = true;
  score = 0;
  timeLeft = 15;
  row = 1; col = 1;
  fishes = spawnFishes();
  renderGrid();
  setMode("game");
  exitGameBtn.style.display="inline-block";

  document.getElementById("status").innerText = `üêü Puntos: 0 | ‚è± Tiempo: 15s`;
  if(lastScore !== null){
    document.getElementById("last").innerText = `√öltimo puntaje: ${lastScore}`;
  }

  clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    timeLeft--;
    document.getElementById("status").innerText = `üêü Puntos: ${score} | ‚è± Tiempo: ${timeLeft}s`;
    if(timeLeft <= 0) endGame();
  },1000);
}

function endGame(){
  clearInterval(timerInterval);
  gameMode = false;
  lastScore = score;
  renderGrid();
  setMode("normal");
  exitGameBtn.style.display = "none";
  document.getElementById("status").innerText = `üéâ ¬°Tiempo terminado! Puntos: ${score}`;
  document.getElementById("last").innerText = `√öltimo puntaje: ${lastScore}`;
}

function exitGame(){
  clearInterval(timerInterval);
  gameMode = false;
  lastScore = score;
  renderGrid();
  setMode("normal");
  exitGameBtn.style.display = "none";
  document.getElementById("status").innerText = `‚ùå Juego cancelado. Puntos: ${score}`;
  document.getElementById("last").innerText = `√öltimo puntaje: ${lastScore}`;
}

function spawnFishes(){
  let arr = [];
  for(let i=0;i<3;i++){
    let r = Math.floor(Math.random()*size);
    let c = Math.floor(Math.random()*size);
    if(r===row && c===col){ i--; continue; }
    arr.push({r,c});
  }
  return arr;
}

function checkCollision(){
  fishes = fishes.filter(f=>{
    if(f.r===row && f.c===col){
      score++;
      return false;
    }
    return true;
  });
  if(fishes.length===0){
    fishes = spawnFishes();
  }
  renderGrid();
}

// --- Control con teclado (solo PC) ---
document.addEventListener("keydown",(e)=>{
  if(e.key==="ArrowUp") move("up");
  if(e.key==="ArrowDown") move("down");
  if(e.key==="ArrowLeft") move("left");
  if(e.key==="ArrowRight") move("right");
});
</script>
</body>
</html>








